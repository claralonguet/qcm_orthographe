<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puissance 4 - Joueur vs Ordinateur</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-image: url('fond2.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        h1 {
            font-size: 4vw;
            margin: 10px 0;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1vw;
            width: 90vw;
            max-width: 600px;
        }

        .cell {
            width: 100%;
            aspect-ratio: 1;
            background-color: rgba(220, 220, 220, 0.8);
            border-radius: 50%;
            border: 1px solid #aaa;
            cursor: pointer;
        }

        .cell.red {
            background-color: red;
        }

        .cell.yellow {
            background-color: yellow;
        }

        .message {
            margin: 20px;
            font-size: 3vw;
        }

        #endButton {
            margin-top: 20px;
            padding: 12px 24px;
            font-size: 2vw;
            background-color: #444;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: none;
        }

        #endButton:hover {
            background-color: #666;
        }

        @media (max-width: 600px) {
            h1 { font-size: 6vw; }
            .message { font-size: 4vw; }
            #endButton { font-size: 4vw; }
        }
    </style>
</head>

<body>

<h1>Puissance 4 - Joueur vs Ordinateur</h1>
<div class="message">Ã€ vous de jouer !</div>
<div class="grid" id="grid"></div>

<button id="endButton" onclick="goToIndex()">Retour au travail !</button>

<script>
    const ROWS = 6;
    const COLUMNS = 7;
    const grid = document.getElementById("grid");
    const message = document.querySelector(".message");
    const endButton = document.getElementById("endButton");

    let board = [];
    let currentPlayer = "red";

    function createBoard() {
        grid.innerHTML = "";
        board = Array.from({ length: ROWS }, () => Array(COLUMNS).fill(null));

        for (let row = 0; row < ROWS; row++) {
            for (let col = 0; col < COLUMNS; col++) {
                const cell = document.createElement("div");
                cell.classList.add("cell");
                cell.dataset.row = row;
                cell.dataset.col = col;
                cell.addEventListener("click", handleCellClick);
                grid.appendChild(cell);
            }
        }
    }

    function handleCellClick(e) {
        if (currentPlayer !== "red") return;

        const col = parseInt(e.target.dataset.col);

        if (placeToken(col, "red")) {
            if (checkWin("red")) {
                message.textContent = "Vous avez gagnÃ© ðŸŽ‰";
                endGame();
                return;
            }
            currentPlayer = "yellow";
            message.textContent = "Tour de l'ordinateur...";
            setTimeout(computerTurn, 700);
        }
    }

    // ðŸ§  IA amÃ©liorÃ©e
    function computerTurn() {

        // 1ï¸âƒ£ Gagner si possible
        for (let col = 0; col < COLUMNS; col++) {
            if (canPlaceToken(col)) {
                const row = getNextRow(col);
                board[row][col] = "yellow";
                if (checkWin("yellow")) {
                    updateBoard();
                    message.textContent = "L'ordinateur a gagnÃ© ðŸ¤–";
                    endGame();
                    return;
                }
                board[row][col] = null;
            }
        }

        // 2ï¸âƒ£ Bloquer le joueur
        for (let col = 0; col < COLUMNS; col++) {
            if (canPlaceToken(col)) {
                const row = getNextRow(col);
                board[row][col] = "red";
                if (checkWin("red")) {
                    board[row][col] = "yellow";
                    updateBoard();
                    currentPlayer = "red";
                    message.textContent = "Ã€ vous de jouer !";
                    return;
                }
                board[row][col] = null;
            }
        }

        // 3ï¸âƒ£ Jouer au centre
        const center = Math.floor(COLUMNS / 2);
        if (canPlaceToken(center)) {
            placeToken(center, "yellow");
            currentPlayer = "red";
            message.textContent = "Ã€ vous de jouer !";
            return;
        }

        // 4ï¸âƒ£ Colonne valide alÃ©atoire
        let validCols = [];
        for (let col = 0; col < COLUMNS; col++) {
            if (canPlaceToken(col)) validCols.push(col);
        }

        const col = validCols[Math.floor(Math.random() * validCols.length)];
        placeToken(col, "yellow");
        currentPlayer = "red";
        message.textContent = "Ã€ vous de jouer !";
    }

    function getNextRow(col) {
        for (let row = ROWS - 1; row >= 0; row--) {
            if (!board[row][col]) return row;
        }
        return -1;
    }

    function canPlaceToken(col) {
        return board[0][col] === null;
    }

    function placeToken(col, color) {
        for (let row = ROWS - 1; row >= 0; row--) {
            if (!board[row][col]) {
                board[row][col] = color;
                updateBoard();
                return true;
            }
        }
        return false;
    }

    function updateBoard() {
        for (let row = 0; row < ROWS; row++) {
            for (let col = 0; col < COLUMNS; col++) {
                const cell = document.querySelector(
                    `.cell[data-row="${row}"][data-col="${col}"]`
                );
                cell.classList.remove("red", "yellow");
                if (board[row][col]) {
                    cell.classList.add(board[row][col]);
                }
            }
        }
    }

    function checkWin(color) {
        return (
            checkDirection(color, 1, 0) ||
            checkDirection(color, 0, 1) ||
            checkDirection(color, 1, 1) ||
            checkDirection(color, 1, -1)
        );
    }

    function checkDirection(color, rDir, cDir) {
        for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLUMNS; c++) {
                let count = 0;
                let rr = r;
                let cc = c;
                while (
                    rr >= 0 && rr < ROWS &&
                    cc >= 0 && cc < COLUMNS &&
                    board[rr][cc] === color
                ) {
                    count++;
                    rr += rDir;
                    cc += cDir;
                }
                if (count >= 4) return true;
            }
        }
        return false;
    }

    function endGame() {
        grid.querySelectorAll(".cell").forEach(cell =>
            cell.removeEventListener("click", handleCellClick)
        );
        endButton.style.display = "block";
    }

    function goToIndex() {
        window.location.href = "index.html";
    }

    createBoard();
</script>

</body>
</html>
